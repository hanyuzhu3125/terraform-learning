# Terraform基本概念

## 1.**module とは何か？**

モジュールは、再利用可能な Terraform コードのパッケージです。

**`modules/nginx`**が関数のように用意されており、それを各環境から使用する形になります。

今回の例では **`test`** という環境から **`nginx`** の module を使う形になっております。

※**`environments`**や**`modules`**,**`test`** というフォルダの文字列は著者が自由に付けた名前であり、制約はありません。

モジュールの特徴には下記のようなものがあります。

- **コードの再利用性の向上**
- **設定の抽象化**
- **環境間での一貫性の確保**
- **変更の影響範囲の制御**

モジュールの構成要素は簡単に、以下のようになっております。

- **`source`: モジュールのソースパス**
- **入力変数: モジュールに渡す変数**

**`source`** で指定されたソースに記載されているリソースが構築できる形になります。

## **2. Variables, Locals（変数）とは何か？**

Terraform では、変数を使用して設定を再利用可能にし、環境ごとの違いを管理します。

### **Variables（変数）**

変数は **`variable`** ブロックで定義します。

**`modules/nginx/variable.tf`** を参照してください。

- `description`: 変数の説明文
- `type`: 変数の型（string、number、bool など）
- `default`: デフォルト値（任意）

**`environments/xxx/variable.tf`**を参照してください。

ここで**`nginx`**の module で定義された変数に具体的な値を代入します。

これらの変数を環境毎に変えることにより、具体的な成果物が環境毎に変わるようになります。

### **Locals（ローカル変数）**

ローカル値は、複雑な式や計算結果を再利用可能な形で保存します。

**`modules/nginx/local.tf`** を参照してください。

下記のように locals を定義します。

**`modules/nginx/nginx.tf`** を参照してください。

このようにしてローカル変数を使うことが可能です。

## **3. データ型について**

Terraform の主要なデータ型は以下の通りです。

- **基本型**
    - `string`: 文字列型
    - `number`: 数値型
    - `bool`: 真偽値型
- **複合型**
    - `list`: 順序付きリスト型
    - `map`: キーと値のペア型
    - `object`: 異なる型を持つ名前付き属性の集合型

例えば今回の **`environment`**, ** `container_ports`** 変数は string 型や　object 型を使っております。

## **4. terraform ブロックとは何か？**

**`terraform`** ブロックは、Terraform 自体の設定を定義するブロックです。

**`modules/nginx/provider.tf`** を参照してください。

主な設定項目は以下になります。

- **`required_providers`**: 必要なプロバイダーとバージョンの指定
- **`required_version`**: 必要な Terraform のバージョン指定
- **`backend`**: 状態ファイルの保存場所の設定

今回の設定では **`required_providers`** のみ設定されております。

## **5. provider ブロックとは何か？**

プロバイダーブロックは、特定のインフラストラクチャプラットフォームとの連携方法を定義します。

**`modules/nginx/provider.tf`** を参照してください。

主な役割は以下になります。

- プロバイダー固有の設定定義
- 認証情報の設定
- 接続先エンドポイントの指定

## **6. resource ブロックとは何か？**

リソースブロックは、実際のインフラストラクチャコンポーネントを定義します。

今回の構成要素は以下になります。

- リソースタイプ（例：**`docker_container`** ）
- リソース名（例：**`nginx`** ）

resource ブロックにはそれぞれ固有のフィールドがあり、それぞれ自分で設定した値を埋めることで必要な形式のリソースを構築することが可能です。

例えば **`docker_container`** の resource block は以下になります。

## **7. resource の参照とは何か？**

リソース間の依存関係を表現するために、他のリソースを参照する方法です

**`modules/nginx/nginx.tf`** を参照してください。

参照の書き方は以下のようになります。

- **`<リソースタイプ>.<リソース名>.<属性>`**
- 例：**`docker_image.nginx.image_id`**